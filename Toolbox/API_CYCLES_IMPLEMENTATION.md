# Market Cycles API - Implementation Guide

**Date:** 2025-11-13
**For:** Engineer AI - API Server Implementation
**Project:** Scout Market Intelligence Dashboard

---

## **Overview**

Add `/api/cycles` endpoint to existing API server at `192.168.10.56:3000`. This endpoint will serve market cycle data (presidential cycles, seasonality, Fed policy, economic cycles, options expiration, earnings seasons) for Scout's trading dashboard.

---

## **Source Data**

**Markdown File Location:**
```
C:\Users\Iccanui\Documents\Projects\Scout\Research\Inbox\compass_artifact_wf-9e9f7fb4-4771-4771-94b4-dadec3681ff2_text_markdown.md
```

**Contents:**
- 33 market cycles across 6 categories
- Complete statistics, confidence scores, trading implications
- Generated by Claude Research with historical market data (1974-2025)

---

## **Task 1: Parse Markdown to JSON**

Create a parser script (Python or Node.js) to convert the markdown cycles into structured JSON.

### **Target JSON Structure:**

```json
{
  "metadata": {
    "last_updated": "2025-11-13T00:00:00Z",
    "version": "1.0",
    "data_source": "Historical market analysis",
    "coverage_period": "1974-2025",
    "total_cycles": 33,
    "active_cycles": 5
  },
  "cycles": [
    {
      "id": "pres_year3",
      "name": "Presidential Year 3",
      "category": "presidential",
      "description": "Third year historically strongest for equities",
      "current_status": {
        "active": true,
        "phase": "Year 3 - Biden Administration",
        "start_date": "2025-01-20",
        "end_date": "2026-01-20",
        "days_remaining": 68,
        "days_elapsed": 297
      },
      "statistics": {
        "avg_return": 17.2,
        "median_return": 16.2,
        "win_rate": 90.0,
        "sample_size": 18,
        "std_deviation": 13.0,
        "best_return": 43.0,
        "worst_return": -5.0,
        "lookback_period": "1950-2024"
      },
      "confidence": {
        "score": 85,
        "level": "High",
        "p_value": "<0.01",
        "significance": "Most reliable presidential cycle pattern with 90% win rate"
      },
      "next_triggers": [
        {
          "date": "2026-01-20",
          "event": "Year 4 begins (Presidential Election Year)",
          "expected_impact": "Shift from strong bullish to moderate/neutral bias"
        }
      ],
      "failure_conditions": [
        "Recession declared by NBER",
        "Market drawdown exceeds 20%",
        "Major geopolitical crisis or financial system shock"
      ],
      "trading_implications": "Strongest year of presidential cycle. Favor long bias and increase equity exposure especially in Q4. Historical pattern suggests presidents focus on economic stimulus for re-election.",
      "sector_performance": {
        "strongest": ["Technology", "Financials", "Consumer Discretionary"],
        "weakest": ["Utilities", "Consumer Staples"]
      }
    }
  ]
}
```

### **Field Mappings from Markdown:**

Parse each cycle section (separated by `---`) and extract:

- **ID:** Convert name to lowercase slug (e.g., "Presidential Year 3" → "pres_year3")
- **Category:** From "Category:" field
- **Active:** From "Active:" field (Yes/No → true/false)
- **Statistics:** Parse numbers from "Statistics:" section
- **Confidence:** Parse from "Confidence:" section
- **Next Trigger:** Parse from "Next Trigger:" section
- **Failure Conditions:** Parse list from "Failure Conditions:"
- **Sector Performance:** Parse "Strongest:" and "Weakest:" lists

### **Output Location:**

Save parsed JSON as:
```
/data/market_cycles.json
```
(on API server)

---

## **Task 2: Create API Endpoints**

Add these endpoints to existing Express/Node.js API server:

### **Endpoint 1: Get All Cycles**

```javascript
// GET /api/cycles
// Returns all cycles with metadata
app.get('/api/cycles', (req, res) => {
  try {
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));

    // Enrich cycles with computed fields
    data.cycles = data.cycles.map(enrichCycle);

    res.json(data);
  } catch (error) {
    res.status(500).json({ error: 'Failed to load cycles data' });
  }
});
```

### **Endpoint 2: Get Active Cycles Only**

```javascript
// GET /api/cycles/active
// Returns only currently active cycles
app.get('/api/cycles/active', (req, res) => {
  try {
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));
    data.cycles = data.cycles.map(enrichCycle);

    const activeCycles = data.cycles.filter(c => c.current_status.active === true);

    res.json({
      metadata: data.metadata,
      cycles: activeCycles,
      count: activeCycles.length
    });
  } catch (error) {
    res.status(500).json({ error: 'Failed to load cycles data' });
  }
});
```

### **Endpoint 3: Get Cycles by Category**

```javascript
// GET /api/cycles/category/:category
// Categories: presidential, seasonality, fed_policy, economic, options_expiration, earnings
app.get('/api/cycles/category/:category', (req, res) => {
  try {
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));
    data.cycles = data.cycles.map(enrichCycle);

    const filtered = data.cycles.filter(c => c.category === req.params.category);

    if (filtered.length === 0) {
      return res.status(404).json({ error: `No cycles found for category: ${req.params.category}` });
    }

    res.json({
      metadata: data.metadata,
      category: req.params.category,
      cycles: filtered,
      count: filtered.length
    });
  } catch (error) {
    res.status(500).json({ error: 'Failed to load cycles data' });
  }
});
```

### **Endpoint 4: Get Specific Cycle by ID**

```javascript
// GET /api/cycles/:id
// Returns single cycle by ID (e.g., pres_year3, santa_rally)
app.get('/api/cycles/:id', (req, res) => {
  try {
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));
    data.cycles = data.cycles.map(enrichCycle);

    const cycle = data.cycles.find(c => c.id === req.params.id);

    if (!cycle) {
      return res.status(404).json({ error: `Cycle not found: ${req.params.id}` });
    }

    res.json(cycle);
  } catch (error) {
    res.status(500).json({ error: 'Failed to load cycles data' });
  }
});
```

### **Endpoint 5: Get Upcoming Cycles**

```javascript
// GET /api/cycles/upcoming?days=30
// Returns cycles starting within next N days (default: 30)
app.get('/api/cycles/upcoming', (req, res) => {
  try {
    const days = parseInt(req.query.days) || 30;
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));
    data.cycles = data.cycles.map(enrichCycle);

    const now = new Date();
    const upcoming = data.cycles.filter(c => {
      if (c.current_status.active) return false; // Exclude already active

      const startDate = new Date(c.current_status.start_date);
      const daysUntilStart = (startDate - now) / (1000 * 60 * 60 * 24);

      return daysUntilStart >= 0 && daysUntilStart <= days;
    });

    res.json({
      metadata: data.metadata,
      query: { days_ahead: days },
      cycles: upcoming,
      count: upcoming.length
    });
  } catch (error) {
    res.status(500).json({ error: 'Failed to load cycles data' });
  }
});
```

### **Endpoint 6: Health Check**

```javascript
// GET /api/cycles/health
// Returns API status and data freshness
app.get('/api/cycles/health', (req, res) => {
  try {
    const data = JSON.parse(fs.readFileSync('./data/market_cycles.json', 'utf8'));
    data.cycles = data.cycles.map(enrichCycle);

    const activeCycles = data.cycles.filter(c => c.current_status.active);

    res.json({
      status: 'ok',
      timestamp: new Date().toISOString(),
      data_version: data.metadata.version,
      last_updated: data.metadata.last_updated,
      total_cycles: data.cycles.length,
      active_cycles: activeCycles.length,
      categories: {
        presidential: data.cycles.filter(c => c.category === 'presidential').length,
        seasonality: data.cycles.filter(c => c.category === 'seasonality').length,
        fed_policy: data.cycles.filter(c => c.category === 'fed_policy').length,
        economic: data.cycles.filter(c => c.category === 'economic').length,
        options_expiration: data.cycles.filter(c => c.category === 'options_expiration').length,
        earnings: data.cycles.filter(c => c.category === 'earnings').length
      }
    });
  } catch (error) {
    res.status(500).json({
      status: 'error',
      error: 'Failed to load cycles data'
    });
  }
});
```

---

## **Task 3: Add Computed Fields Helper**

Create helper function to calculate dynamic fields based on current date:

```javascript
function enrichCycle(cycle) {
  const now = new Date();
  const startDate = new Date(cycle.current_status.start_date);
  const endDate = new Date(cycle.current_status.end_date);

  // Determine if cycle is currently active
  cycle.current_status.active = (now >= startDate && now <= endDate);

  if (cycle.current_status.active) {
    // Calculate days remaining and elapsed for active cycles
    cycle.current_status.days_remaining = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
    cycle.current_status.days_elapsed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
    delete cycle.current_status.days_until_start; // Remove if exists
  } else {
    // Calculate days until start for inactive cycles
    const daysUntilStart = Math.ceil((startDate - now) / (1000 * 60 * 60 * 24));
    if (daysUntilStart > 0) {
      cycle.current_status.days_until_start = daysUntilStart;
    }
    delete cycle.current_status.days_remaining; // Remove if exists
    delete cycle.current_status.days_elapsed; // Remove if exists
  }

  return cycle;
}
```

---

## **Task 4: Enable CORS**

Add CORS headers to allow Scout client to access API:

```javascript
// Add before route definitions
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET, OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  next();
});
```

---

## **Task 5: Error Handling**

Add proper error handling for all endpoints:

```javascript
// Global error handler
app.use((err, req, res, next) => {
  console.error('API Error:', err);
  res.status(500).json({
    error: 'Internal server error',
    message: err.message
  });
});

// 404 handler for unknown routes
app.use((req, res) => {
  res.status(404).json({
    error: 'Endpoint not found',
    available_endpoints: [
      '/api/cycles',
      '/api/cycles/active',
      '/api/cycles/category/:category',
      '/api/cycles/:id',
      '/api/cycles/upcoming?days=N',
      '/api/cycles/health'
    ]
  });
});
```

---

## **Testing**

### **Test Commands:**

```bash
# Health check
curl http://192.168.10.56:3000/api/cycles/health

# Get all cycles
curl http://192.168.10.56:3000/api/cycles

# Get active cycles only
curl http://192.168.10.56:3000/api/cycles/active

# Get presidential cycles
curl http://192.168.10.56:3000/api/cycles/category/presidential

# Get specific cycle
curl http://192.168.10.56:3000/api/cycles/pres_year3

# Get cycles starting in next 30 days
curl http://192.168.10.56:3000/api/cycles/upcoming?days=30

# Get seasonality cycles
curl http://192.168.10.56:3000/api/cycles/category/seasonality
```

### **Expected Active Cycles (as of 2025-11-13):**

1. Presidential Year 3
2. Mid Expansion (economic)
3. Rate Cut Cycle (Fed policy)
4. November-December Rally (seasonality)
5. Q3 Earnings Season (ending soon)

---

## **Deliverables**

Once implementation is complete, provide:

1. ✅ **Parser script** (Python or Node.js) - converts markdown to JSON
2. ✅ **market_cycles.json** - parsed data file in `/data` directory
3. ✅ **API endpoints** - all 6 endpoints implemented and tested
4. ✅ **Base URL** - confirm endpoints accessible at `http://192.168.10.56:3000/api/cycles`
5. ✅ **Test results** - show output from test commands above

---

## **Data Update Process**

When market cycles data needs updating:

1. Edit `market_cycles.json` directly, OR
2. Re-run parser script on updated markdown file
3. Restart API server (or use hot-reload if configured)
4. Verify with health check endpoint

**Update Frequency:** Monthly or quarterly (cycles don't change frequently)

---

## **Integration with Scout**

Scout will call this API during Step 3 (AI Processing) to reference active market cycles when analyzing sentiment data.

Example Scout usage:
```python
import requests

# Fetch active cycles
response = requests.get('http://192.168.10.56:3000/api/cycles/active')
active_cycles = response.json()['cycles']

# Add to AI analysis context
context = f"""
Active Market Cycles (as of today):
{format_cycles_for_prompt(active_cycles)}

Consider these statistical patterns when generating trading recommendations.
"""
```

---

## **Notes**

- All returns are **absolute returns** over cycle period (not annualized)
- **P-values** test null hypothesis that returns = 0 (pattern vs random)
- **Sector performance** shows relative outperformance vs SPY
- **Active status** based on date ranges in source data
- API is **read-only** (no POST/PUT/DELETE needed)

---

## **Questions / Issues**

Contact project owner with:
- Base URL confirmation after deployment
- Any authentication requirements
- Rate limiting settings (if any)
- Data refresh schedule

---

**Source File:**
`C:\Users\Iccanui\Documents\Projects\Scout\Research\Inbox\compass_artifact_wf-9e9f7fb4-4771-4771-94b4-dadec3681ff2_text_markdown.md`

**Implementation Priority:** Medium (enhances Scout analysis but not blocking)

**Estimated Time:** 2-3 hours (parsing + API + testing)
